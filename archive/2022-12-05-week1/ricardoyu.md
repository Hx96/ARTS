# Algorithm

![算法](../../images/ricardoyu-2022-12-11-lc.png "算法")

# Review

[the tail at scale](https://www.docin.com/p-2210365062.html)

长尾延时的存在

一个服务依赖几十上百个服务，单一模块的长尾延时会在有大量依赖的情况下，在服务粒度被放大

为什么会有

1. 共享资源：机器可能被不同的应用程序共享（cpu 核心、处理器缓存、内存、网络）（云上环境
2. 守护程序：后台守护程序可能平均只使用有限的资源，但在运行时可能会产生几毫秒的峰值抖动
3. 维护活动：后台活动（数据重建如使用 lsm tree 的 db 组件，lsm compaction 带来的抖动），垃圾回收（go， map kv 数量多，gc 耗时高
4. 排队：中间服务器和网络交换机多层排队放大了问题

解决

1. 模块内
   1. 服务分级
   2. 减少队头阻塞：协议和连接层面，可以借鉴 http1-http2 的思路
   3. 管理后台活动和同步中断：结合限流功能，把重量级操作分解，在整体负载较低时触发
2. 请求期内的一些自适应手段
   1. 对冲请求：向多个副本发出相同请求，使用首先响应的结果
   2. 捆绑式请求：同时发送多个副本，并同步告诉副本还有其他服务也在执行，副本请求完后，主动请求其他副本取消正在处理的请求，需要额外网络同步

# Tip

# Share
